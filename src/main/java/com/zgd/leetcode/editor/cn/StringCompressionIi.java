//è¡Œç¨‹é•¿åº¦ç¼–ç  æ˜¯ä¸€ç§å¸¸ç”¨çš„å­—ç¬¦ä¸²å‹ç¼©æ–¹æ³•ï¼Œå®ƒå°†è¿ç»­çš„ç›¸åŒå­—ç¬¦ï¼ˆé‡å¤ 2 æ¬¡æˆ–æ›´å¤šæ¬¡ï¼‰æ›¿æ¢ä¸ºå­—ç¬¦å’Œè¡¨ç¤ºå­—ç¬¦è®¡æ•°çš„æ•°å­—ï¼ˆè¡Œç¨‹é•¿åº¦ï¼‰ã€‚ä¾‹å¦‚ï¼Œç”¨æ­¤æ–¹æ³•å‹ç¼©å­—ç¬¦ä¸² 
//"aabccc" ï¼Œå°† "aa" æ›¿æ¢ä¸º "a2" ï¼Œ"ccc" æ›¿æ¢ä¸º` "c3" ã€‚å› æ­¤å‹ç¼©åçš„å­—ç¬¦ä¸²å˜ä¸º "a2bc3" ã€‚ 
//
// æ³¨æ„ï¼Œæœ¬é—®é¢˜ä¸­ï¼Œå‹ç¼©æ—¶æ²¡æœ‰åœ¨å•ä¸ªå­—ç¬¦åé™„åŠ è®¡æ•° '1' ã€‚ 
//
// ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² s å’Œä¸€ä¸ªæ•´æ•° k ã€‚ä½ éœ€è¦ä»å­—ç¬¦ä¸² s ä¸­åˆ é™¤æœ€å¤š k ä¸ªå­—ç¬¦ï¼Œä»¥ä½¿ s çš„è¡Œç¨‹é•¿åº¦ç¼–ç é•¿åº¦æœ€å°ã€‚ 
//
// è¯·ä½ è¿”å›åˆ é™¤æœ€å¤š k ä¸ªå­—ç¬¦åï¼Œs è¡Œç¨‹é•¿åº¦ç¼–ç çš„æœ€å°é•¿åº¦ ã€‚ 
//
// 
//
// ç¤ºä¾‹ 1ï¼š a100ba
//
// è¾“å…¥ï¼šs = "aaabcccd", k = 2    >>> aaaccc
//è¾“å‡ºï¼š4
//è§£é‡Šï¼šåœ¨ä¸åˆ é™¤ä»»ä½•å†…å®¹çš„æƒ…å†µä¸‹ï¼Œå‹ç¼©åçš„å­—ç¬¦ä¸²æ˜¯ "a3bc3d" ï¼Œé•¿åº¦ä¸º 6 ã€‚æœ€ä¼˜çš„æ–¹æ¡ˆæ˜¯åˆ é™¤ 'b' å’Œ 'd'ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå‹ç¼©åçš„å­—ç¬¦ä¸²ä¸º "a3
//c3" ï¼Œé•¿åº¦æ˜¯ 4 ã€‚ 
//
// ç¤ºä¾‹ 2ï¼š 
//
// è¾“å…¥ï¼šs = "aabbaa", k = 2   a2b2a2
//è¾“å‡ºï¼š2
//è§£é‡Šï¼šå¦‚æœåˆ å»ä¸¤ä¸ª 'b' å­—ç¬¦ï¼Œé‚£ä¹ˆå‹ç¼©åçš„å­—ç¬¦ä¸²æ˜¯é•¿åº¦ä¸º 2 çš„ "a4" ã€‚
// 
//
// ç¤ºä¾‹ 3ï¼š 
//
// è¾“å…¥ï¼šs = "aaaaaaaaaaa", k = 0
//è¾“å‡ºï¼š3
//è§£é‡Šï¼šç”±äº k ç­‰äº 0 ï¼Œä¸èƒ½åˆ å»ä»»ä½•å­—ç¬¦ã€‚å‹ç¼©åçš„å­—ç¬¦ä¸²æ˜¯ "a11" ï¼Œé•¿åº¦ä¸º 3 ã€‚
// 
//
// 
//
// æç¤ºï¼š 
//
// 
// 1 <= s.length <= 100 
// 0 <= k <= s.length 
// s ä»…åŒ…å«å°å†™è‹±æ–‡å­—æ¯ 
// 
//
// Related Topics å­—ç¬¦ä¸² åŠ¨æ€è§„åˆ’ ğŸ‘ 91 ğŸ‘ 0


  
package com.zgd.leetcode.editor.cn;

import java.util.Arrays;
import java.util.HashMap;
import java.util.Map;

public class StringCompressionIi{

  /**
  * 1531
  * å‹ç¼©å­—ç¬¦ä¸² II
  * 
  * 
  *
  * 2022-11-07 16:19:35
  */  
  public static void main(String[] args) {
    Solution solution = new StringCompressionIi().new Solution();
    solution.getLengthOfOptimalCompression("llllllllllttttttttt",1);
  }
  
  //leetcode submit region begin(Prohibit modification and deletion)
class Solution {


      /**
       * è€è€å®å®ä½¿ç”¨dp
       */
      public int getLengthOfOptimalCompression(String s, int k) {
          if (s.length() <= k){
              return 0;
          }
          //æ—¢ç„¶æ˜¯dp,é¦–è¦ç¡®å®šçš„æ˜¯äºŒç»´åˆ†åˆ«æ˜¯ä»€ä¹ˆ, è¿™é‡Œå¾ˆæ˜æ˜¾,ä¸€ä¸ªæ˜¯ä»å·¦åˆ°å³çš„ä½ç½®i,ä¸€ä¸ªæ˜¯å½“å‰å·²ä½¿ç”¨å‡ æ¬¡åˆ é™¤j
          //dp[i][j] è¡¨ç¤ºåˆ°iä½ç½®ä½¿ç”¨äº†jæ¬¡åˆ é™¤,æœ€å°çš„é•¿åº¦
          int[][] dp = new int[s.length()][k+1];
          //åˆå§‹åŒ–
          for (int[] ints : dp) {
              Arrays.fill(ints,Integer.MAX_VALUE);
          }

          //ä¸»è¦æ€è·¯: æˆ‘ä»¬å·²ç»æŠŠdpåˆå§‹åŒ–ä¸ºæœ€å¤§çš„æ•°å­—äº†,ç„¶åé’ˆå¯¹kæ¬¡åˆ é™¤æœºä¼šå’Œé•¿åº¦nçš„å­—ç¬¦ä¸²,æˆ‘ä»¬å°†å…¶æ’åˆ—ç»„åˆè¿›è¡ŒäºŒæ¬¡éå†
          //ç„¶åéå†åˆ°ç¬¬iä½å€¼,ä½¿ç”¨jæ¬¡åˆ é™¤çš„æ—¶å€™, æˆ‘ä»¬å¯ä»¥é€‰æ‹©åˆ é™¤, æ­¤æ—¶ç›¸å½“äºå­—ç¬¦ä¸²æ²¡å˜,dp[i][j]=dp[i-1][j-1]
          //æˆ‘ä»¬ä¹Ÿå¯é€‰æ‹©ä¸åˆ ,ä¿ç•™,ä¿ç•™çš„è¯å°±éœ€è¦æŠŠç›¸åŒçš„å­—ç¬¦ä¸²åˆå¹¶,æ¯”å¦‚abccdec, è¿™ä¸ªæ—¶å€™å¯ä»¥çœ‹åˆ°,å¦‚æœå‰©ä½™åˆ é™¤æ¬¡æ•°æœ‰2ä»¥ä¸Šçš„è¯,å¯ä»¥æŠŠdeåˆ é™¤,æŠŠcåˆå¹¶.
          //å³dp[i][j]=dp[k][j-diff] + æ•°é‡ ,k=2,diffå³kåˆ°iä¹‹é—´æœ‰å¤šå°‘ä¸æ˜¯c çš„,æ‰€ä»¥diff=2, å†æŠŠcçš„æ•°é‡è¡¥ä¸Šå°±å¤Ÿäº†

          int n = s.length();
          for (int i = 0; i < n; i++) {
              for (int j =  0; j <= k ; j++) {
                  //1. å…ˆæŠŠåˆ é™¤çš„æƒ…å†µä¿å­˜åˆ°dp
                  if (j > 0 ){
                      //è¿™é‡Œiæ˜¯ä»0å¼€å§‹çš„,i+1è¡¨ç¤ºç¬¬å‡ ä¸ªå­—ç¬¦,å½“j>i+1è¡¨ç¤ºå®ƒå®Œå…¨æœ‰èƒ½åŠ›åˆ é™¤è¿™äº›å­—ç¬¦
                      if (j >= i+1){
                          //å¯å…¨éƒ¨åˆ é™¤
                          dp[i][j]= 0;
                          continue;
                      }else{
                          //å¦‚æœé€‰æ‹©åˆ é™¤è¯¥å¤„å­—ç¬¦,å®ƒçš„æœ€å°è‡ªç„¶å°±æ˜¯å’Œå‰é¢å­—ç¬¦ä¸€æ ·
                          dp[i][j] = dp[i-1][j-1];
                      }
                  }
                //2. å†è€ƒè™‘ä¸åˆ é™¤çš„æƒ…å†µ,è¿™å°±è¦è®¡ç®—å’Œåˆå¹¶äº†
                  //ä»åå¾€å‰,æŠŠå’Œè¿™ä¸ªå­—ç¬¦ç›¸åŒçš„è¿›è¡Œåˆå¹¶,åŒæ—¶éœ€è¦è€ƒè™‘è¦åˆ é™¤å‡ ä¸ªå­—ç¬¦
                  int diff=0,same=0;
                  for (int l = i; l >=0 && diff<= j ; l--) {
                      if (s.charAt(l) == s.charAt(i)){
                          same++;
                          if (l == 0){
                              //è¡¨ç¤ºæ‰¾ç›¸åŒçš„å…ƒç´ å·²ç»æ‰¾åˆ°äº†å¤´éƒ½å¯ä»¥åˆèµ·æ¥
                              dp[i][j] = Math.min(dp[i][j], cal(same));
                          }else{
                            dp[i][j] = Math.min(dp[i][j], dp[l-1][j-diff]+cal(same));
                          }
                      }else{
                          diff++;
                      }

                  }
              }
          }
          return dp[s.length()-1][k];

      }

      private int cal(int n){
          if (n == 1){
              //a
              return 1;
          }else if (n < 10){
              //aaaa -> a4
              return 2;
          }else if (n < 100){
              return 3;
          }else if (n < 1000){
              return 4;
          }
          return -1;
      }

      /**
       * è¶…æ—¶äº†..
       * è¿™ä¸ªé¢˜ä¸€åº¦æ— æ³•ä¸‹ç¬”,æ€è·¯éƒ½æ²¡æœ‰, çœ‹äº†å‡ ä¸ªè§£æç”¨dp,æ„Ÿè§‰äº‘é‡Œé›¾é‡Œ,çœ‹äº†ä¸€ä¸ªç”¨è®°å¿†æœç´¢çš„,æ„Ÿè§‰æ›´å®¹æ˜“ç†è§£.(ä½†æ˜¯è¶…æ—¶äº†T_T)
       * æˆ‘ä»¬å‡è®¾ä»å·¦åˆ°å³,å¯¹æ¯ä¸ªå­—ç¬¦åˆ¤æ–­,æ¯ä¸ªå­—ç¬¦éƒ½å¯ä»¥é€‰æ‹©æ˜¯åˆ é™¤,è¿˜æ˜¯ä¿ç•™.å¦‚ babcd,kè¡¨ç¤ºå¯åˆ é™¤æ¬¡æ•°,iè¡¨ç¤ºå½“å‰ä½ç½®.
       *  k=3        [b]abcd ->(ä¿ç•™,i++) b[a]bcd
       *            â†™(åˆ é™¤b)
       *  k=2     (b)[a]bcd ->(ä¿ç•™) (b)a[b]cd -> ...
       *        â†™(åˆ é™¤a)              â†™(åˆ é™¤b)
       *     ....
       * æ¯ä¸ªä½ç½®éƒ½å¯ä»¥é€‰æ‹©åˆ å’Œä¸åˆ ,æœ€åå±‚å±‚è·å–ç»“æœ,å°†åˆ å’Œä¸åˆ çš„ç›¸æ¯”è¾ƒ. ä¸ºäº†æé«˜æ•ˆç‡,ä½¿ç”¨mapç¼“å­˜è®°å½•ç»“æœ
       */
    public int getLengthOfOptimalCompression2(String s, int k) {
        //è¡¨ç¤ºå½“å‰åˆ°å“ªä¸ªä½ç½®
        int i = 0;
        //è¡¨ç¤ºä¸Šä¸€ä¸ªç›¸åŒå­—ç¬¦
        char pre = ' ';
        //è¡¨ç¤ºç›¸åŒçš„ä¸ªæ•°
        int same = 0;

        return ji_yi_sou_suo(s,i,k,pre,same);
    }
    private Map<String,Integer> cache = new HashMap<>();

    private int ji_yi_sou_suo(String s,int i,int k,char pre,int same){
        //å…¨åˆ äº†
        if (k >= s.length()){
            return 0;
        }

        if ( cache.containsKey(i+"_"+k+"_"+pre+"_"+same)){
            return cache.get(i+"_"+k+"_"+pre+"_"+same);
        }
        if (i == s.length()){
            return 0;
        }
        //åˆ†åˆ«è®°å½•åˆ ,å’Œä¸åˆ ä¸¤ç§æƒ…å†µçš„ç»“æœ,çœ‹é€‰æ‹©å“ªä¸ªå¥½
        int delete = Integer.MAX_VALUE,skip = Integer.MAX_VALUE;
        if (k > 0){
            //åˆ ,å…¶å®å°±æ˜¯è·³è¿‡
            delete = ji_yi_sou_suo(s,i+1,k-1,pre,same);
        }

        //æ˜¯å¦éœ€è¦åŠ é•¿åº¦,å‡ºç°åˆ™ä¸º1. è¿™é‡Œå¿…é¡»è¦ç”¨ä¸€ä¸ªæ–°å˜é‡æ¥æ¥å—,å› ä¸ºåé¢ç¼“å­˜çš„æ—¶å€™éœ€è¦åŸæ¥çš„å…¥å‚
        int addLen = 0,newsame = same;
        char newpre = pre;
        //ä¿ç•™çš„æƒ…å†µ
        if (s.charAt(i) == pre){
            //å¦‚æœå’Œä¹‹å‰ç›¸åŒçš„ä¸€æ ·,æœ‰ä¸¤ç§æƒ…å†µ,æ¯”å¦‚ä¹‹å‰æ˜¯a9,æˆ–a99, å†åŠ ä¸€å°±è¿›ä½é•¿åº¦+1
            // æˆ–è€…ä¹‹å‰æ˜¯å•ç‹¬ä¸€ä¸ªa,å†æ¥ä¸€ä¸ªaå˜æˆa2ä¹Ÿè¦åŠ é•¿åº¦
            if (same == 1 ||((same + 1)+"").length() > (same+"").length()){
                addLen = 1;
            }
            newsame = same+1;
        }else{
            //å’Œå‰ä¸€ä½ä¸ç›¸åŒ
            newpre = s.charAt(i);
            newsame = 1;
            addLen=1;
        }
        skip = addLen + ji_yi_sou_suo(s,i+1,k,newpre,newsame);
        //æ¯”è¾ƒä¸¤ä¸ªå“ªä¸ªå¤§,å–å°çš„
        int min = Math.min(delete ,skip);
        //ç¼“å­˜
        cache.put(i+"_"+k+"_"+pre+"_"+same,min);
        return min;

    }
}
//leetcode submit region end(Prohibit modification and deletion)

}